# 更新记录

## [v2.0.6]
- 新增: 下载原始对账单功能，转换为指定格式进行下载
- 新增: 增加对账结果计算和显示，以及对单差异数据查看功能
- 新增: 自动分账功能，支付完成后自动根据默认分账组将订单分账
- 新增: 三方支付通道订单号规则优化: 支付P、退款R、分账A，可以根据环境加前缀：DEV_、DEMO_、PRE_
- 优化: 去除组合支付概念，删除现金支付和储值卡支付方式，系统整体复杂度降低一半以上
- 优化: 消息通知发送流程改造，不在使用复杂继承组合关系，只保留一级类继承关系
- 优化: 回调通知处理不再使用继承模式，修改为组合模式，提高阅读和debug的便利性
- 优化: 支付同步、回调和退款同步、回调去除组合支付导致的特殊处理逻辑
- 优化: 统一公共请求参数和响应参数，同时响应参数格式，便于进行统一处理
- 优化: 统一参数命名规则，包括支付、退款、对账、分账等相关参数的属性，实现风格的统一
- 优化: 使用切面统一处理API调用异常, 做统一包装返回
- 优化: 金额显示统一使用元
- 优化: 前端查询条件适配，统一页面交互逻辑，初步完成管理端的功能完备性
- 优化: 支持自动同步对账结果，并自动对分账单进行完结
- 优化: 基础脚手架从jar集成修改为源码集成
- fix: 自动同步任务不生效
- fix: 算收款金额时对产生退款的支付订单未进行计算
## [v2.0.5]
- 新增: 支持支付宝分账功能
- 新增: 支持微信分账功能
- 新增: 分账接收者和分账组管理
- 新增: 支持分账结果同步功能
- 新增: 支付通道配置中支持是否支持分账
- 新增: SDK支持分账接口
- 优化: 收银台演示支持设置是否分账
- fix: 修复创建支付订单报错时, 订单保存数据不完整
## [v2.0.4]
- 新增: 首页驾驶舱功能: 各通道收入和支付情况
- 新增: 云闪付支持对账功能
- 新增: 对账文件支持手动导入
- 新增: 结算台DEMO增加云闪付示例
- 新增: 增加支付限额，包括整单限额和通道限额
- 优化: 支付流程也改为先落库后支付情况, 避免极端情况导致掉单
- 优化: 前端列表状态显示优化
- fix: 对账订单流水号生成规则不是按天生成修改

## [v2.0.3]
- 增加云闪付通道，支持支付、退款、同步、回调处理
- 增加定时同步退款中的退款订单任务
- 增加通知任务订单的状态类型，例如订单关闭、成功、失败等
- 增加退款操作支持重试
- 增加手动触发通知任务消息的发送功能

##  [v2.0.2]
- 增加微信支付对账功能
- 增加支付宝支付对账功能
- 优化: 修复策略对订单时间和状态字段的变更优化
- fix: 前端支付订单查询条件中"支付ID"条件不生效

##  [v2.0.1]
- 增加支付、退款时客户通知功能，支持多次重发
- 开源文档增加支付通知和退款通知文档
- 增加客户通知任务记录功能
- 支持钱包支付、流水记录、各类操作等功能
- 支持储值卡支付、流水记录、各类操作等功能
- 支持现金支付和流水记录功能
- 增加支付宝流水记录功能
- 增加微信流水记录功能
- 变更: 废弃调用接口时的`version`字段，调用时不再进行传输，SDK中同步进行删除
- 优化: 订单支持关闭时间记录
- 优化: 增加退款订单扩展记录
- 优化: SDK增加简单退款、多通道退款等多中测试样例
- 优化: IJPay进行Https请求时, TLS版本使用读取JDK中支持的版本
- fix: 同步支付通道订单不能正确生成
- fix: 修复聚合条码支付时付款码未传输问题
- fix: 修复微信退款同步时, 错误信息未保存问题
- fix: 修复手动发起退款时上下文未进行初始化的问题
- fix: 修复简单退款选择全部退款时报错问题
- fix: 修复退款时未检验退款金额问题，导致可以退款余额可以大于可退余额

##  [v2.0.0]
- 支持支付宝支付: 扫码支付、付款码支付、PC支付、H5支付
- 支持微信支付: 扫码支付、WAP支付、公众号支付
- 增加聚合支付演示功能，支持支付宝和微信支付
- 增加PC收银台演示功能，各种类型的支付
- 增加手机收银台演示功能，支持在微信、支付宝、浏览器中发起对应的请求
- 提供Java版本SDK，简化业务系统对支付网关的调用
- 支持请求参数签名和验签机制，已经支持SHA256和MD5
- 支持支付订单超时自动进行关闭
- 支持支付订单手动关闭功能
- 支持支付退款功能，可以进行全部退款或部分退款
- 支持支付同步功能，通过同步接口可以获取第三方支付网关的状态
- 支持支付和退款订单的修复功能，根据取第三方支付网关订单的状态，对订单进行修正，如支付同步、退款同步、消息回调等可触发
- 部分支付对账功能，已经实现支付宝和微信对账单下载解析和保存的功能
- 支持对各支付通道进行管理，包括是否启用、显示Logo图等
- 支持对支付网关对外暴露的接口进行管理，支持启停用、是否验签、是否消息通知等功能
- 去除调用时的用户概念，作为独立的支付网关使用
- 组合支付已预先进行支持，支持一个异步支付+多个同步支付通道组合进行收单支付
- 记录支付时出现的回调记录、同步记录、修复记录、关闭记录
