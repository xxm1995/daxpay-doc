# 支付订单通知

## 通知方式

| 参数      | 说明                 |
|---------|--------------------|
| 请求方式    | `POST`             |
| 请求类型    | `application/json` |
| 客户系统应答值 | 大写 `SUCCESS` 字符串   |


## 通知规则
当满足下列通知时机时，系统会将支付订单状态变化通知到商户的接收地址上。商户需要接收处理该消息并返回应答。

如果收到客户系统的应答不符合规范或超时，支付网关会认为通知失败，并通过一定的策略定期重新发起通知，尽可能提高通知的成功率，但微信不保证通知最终能成功。
（通知频率为`15s/15s/30s/3m/10m/20m/30m/30m/30m/60m/3h/3h/3h/6h/6h`- 总计 24h4m）


## 通知时机
> 当支付订单状态发生变化时，系统会主动将支付订单状态变化通知到商户的接收地址上。**注意：调用接口发起支付时，出现的支付失败也不会触发通知，因为当前订单状态不会发生变化，依然是支付中**

| 支付状态 | 描述                            | 是否通知 |
|------|-------------------------------|------|
| 支付创建 | 创建支付单或者通过修复从其他状态变更为支付中，不会推送通知 | 否    |
| 支付成功 | 支付完成后会推送通知                    | 是    |
| 支付失败 | 在存在异步通道情况下，三方网关回调通知支付失败，会推送通知 | 是    |
| 支付关闭 | 当支付单被关闭时，会推送通知                | 是    |
| 退款中  | 会在对应的退款单发起通知                  | 否    |
| 部分退款 | 会在对应的退款单发起通知                  | 否    |
| 全部退款 | 会在对应的退款单发起通知                  | 否    |


## 注意事项
1. 回调地址必须可被支付网关访问
2. 回调地址仅支持http与https协议
3. 如果文档开启验签，参照[签名规则](../overview/签名规则.md)文档进行验签

## 通知参数

| 字段名<img width=70/> | 变量名       | 必传 | 类型               | 示例值                           | 描述                                                         |
| --------------------- | ------------ | ---- | ------------------ | -------------------------------- | ------------------------------------------------------------ |
| 支付ID                | paymentId    | 是   | Long               | 1753370980523384832              | 这次支付单的唯一标示                                         |
| 业务号                | businessNo   | 是   | String             | P0001                            | 支付时客户系统传输的业务编码                                 |
| 是否是异步支付        | asyncPay     | 是   | boolean            | true                             | 本次支付中是否存在异步支付通道                               |
| 异步支付通道          | asyncChannel | 否   | String             | ali_pay                          | 支付的通道编码，如微信支付、支付宝支付等。见常量和状态表[PayChannelEnum](/single/guides/other/常量和状态表.md#支付通道-paychannelenum)相关的描述 |
| 支付金额              | amount       | 是   | Integer            | 18                               | 支付的金额，单位为**分**                                     |
| 支付通道信息          | payChannels  | 是   | PayChannelResult[] | 略                               | 见下方`PayChannelResult`参数介绍                             |
| 支付状态              | status       | 是   | String             | success                          | 见常量和状态表[PayStatusEnum](/single/guides/other/常量和状态表.md#支付状态-paystatusenum)相关的描述 |
| 支付创建时间          | createTime   | 是   | Long               | 123123121                        | 使用时间戳(秒级)                                             |
| 支付成功时间          | payTime      | 否   | Long               | 123133121                        | 使用时间戳(秒级)                                             |
| 支付关闭时间          | closeTime    | 否   | Long               | 123223121                        | 使用时间戳(秒级)                                             |
| 商户扩展参数          | attach       | 是   | String             | "{data:1234}"                    | 回调时会原样返回                                             |
| 签名                  | sign         | 是   | String             | 072695d112892e382a7093b81e6a52af | 如果在后台系统中开启验签选项后必填                           |

### PayChannelResult参数

| 字段名<img width=70/> | 变量名  | 必传 | 类型   | 示例值 | 描述                                                         |
| --------------------- | ------- | ---- | ------ | ------ | ------------------------------------------------------------ |
| 支付通道              | channel | 是   | String |        | 进行支付的通道编码，如微信支付、支付宝支付等。见常量和状态表[PayChannelEnum](/single/guides/other/常量和状态表.md#支付通道-paychannelenum)相关的描述 |
| 支付方式              | way     | 是   | String |        | 进行支付的方式编码，如扫码支付、条码支付等。见常量和状态表[PayWayEnum](/single/guides/other/常量和状态表.md#支付方式-paywayenum)相关的描述 |
| 支付金额              | amount  | 是   | String |        | 支付的金额，单位为**分**                                     |

## 通知示例

```json
{
  "paymentId":  1761443844421992448,
  "businessNo":  "P49738",
  "asyncPay":  false,
  "amount":  12,
  "payChannels":  [
    {
      "channel":  "cash_pay",
      "way":  "normal",
      "amount":  12
    }
  ],
  "status":  "success",
  "createTime":  1708795913212,
  "payTime":  1708795913334
}
```

## SDK使用说明
> 可以使用SDK对接收到的通知内容进行反序列和验签，简化消息通知的处理流程。

### 使用Spring MVC的反序列化方式

### 手动转换为对象

### 验签
